plugins {
	id "com.moowork.node" version "1.2.0"
}

//def generatedWebResources = "${buildDir}/generated-web-resources"

/*sourceSets {
	main {
		output.dir(generatedWebResources, builtBy: 'npm_run_build')
	}
}*/

// configure gradle-node-plugin
node {
	version = '7.5.0'
	npmVersion = '4.1.2'
	download = true
	workDir = file("${project.projectDir}/node")
	nodeModulesDir = file("${project.projectDir}/")
}

// clean node/node_modules/dist
task npmClean(type: Delete) {
	final def webDir = "."
	delete "${webDir}/node"
	delete "${webDir}/node_modules"
	delete "${webDir}/dist"
	delete "${webDir}/www"
}

// clean task for npm
task clean {}
clean.dependsOn(npmClean)

task develop {}

task deletePlatforms(type: Delete) {
  dependsOn npm_install
  delete 'platforms/ios'
}

task installPlatforms(type: NodeTask) {
  dependsOn deletePlatforms
  script = file('/usr/local/bin/cordova')
  args = ['platform', 'add', 'ios']
}


// build task for npm
task build(type: NodeTask) {
  dependsOn installPlatforms
  script = file('/usr/local/bin/cordova')
  args = ['build', 'ios']
}

build.dependsOn(npm_install)

// assemble task for npm
task assemble {}
assemble.dependsOn(build)
